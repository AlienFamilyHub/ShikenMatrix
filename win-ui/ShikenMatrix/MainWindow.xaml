<?xml version="1.0" encoding="utf-8"?>
<Window
    x:Class="ShikenMatrix.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:ShikenMatrix"
    xmlns:controls="using:ShikenMatrix.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Title="ShikenMatrix">

    <!-- 启用云母材质 (Mica Alt)，为了让它生效，根 Grid 必须透明 -->
    <Window.SystemBackdrop>
        <MicaBackdrop Kind="BaseAlt"/>
    </Window.SystemBackdrop>

    <!-- 根容器背景透明，透出 Mica 效果 -->
    <Grid Background="Transparent">

        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="280"
                    MinWidth="260"
                    MaxWidth="350"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- MARK: 左侧面板 - 控制区 -->
        <!-- 使用 Acrylic 风格的半透明背景叠加 -->
        <Grid Grid.Column="0"
              Background="{ThemeResource LayerFillColorAltBrush}"
              BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
              BorderThickness="0,0,1,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <!-- 顶部控制 -->
                <RowDefinition Height="*"/>
                <!-- 滚动内容 -->
                <RowDefinition Height="Auto"/>
                <!-- 底部版权 -->
            </Grid.RowDefinitions>

            <!-- 1. 顶部控制栏 -->
            <controls:StatusCard Grid.Row="0"
                                 DataContext="{x:Bind ViewModel, Mode=OneWay}"/>

            <MenuFlyoutSeparator Grid.Row="0"
                                 VerticalAlignment="Bottom"
                                 Margin="20,0,20,0"/>

            <!-- 2. 内容区 -->
            <ScrollViewer Grid.Row="1"
                          Padding="20">
                <StackPanel Spacing="6">
                    <!-- 监控卡片 -->
                    <controls:MonitorCard DataContext="{x:Bind ViewModel, Mode=OneWay}"/>

                    <Rectangle Height="1"
                               Fill="{ThemeResource DividerStrokeColorDefaultBrush}"
                               Margin="0,12,0,16"/>

                    <!-- 配置面板 -->
                    <controls:ConfigPanel DataContext="{x:Bind ViewModel, Mode=OneWay}"/>
                </StackPanel>
            </ScrollViewer>

            <!-- 3. 底部信息 -->
            <StackPanel Grid.Row="2"
                    Background="{ThemeResource LayerFillColorDefaultBrush}"
                    Padding="16,12"
                        BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
                    BorderThickness="0,1,0,0">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0"
                                VerticalAlignment="Center">
                        <TextBlock Text="SHIKEN MATRIX"
                                FontSize="10"
                                FontWeight="Bold"
                                Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        <TextBlock FontSize="9"
                                Foreground="{ThemeResource TextFillColorTertiaryBrush}">
                            <Run Text="v"/>
                            <Run Text="{Binding Version}"/>
                            <Run Text=" • Stable"/>
                        </TextBlock>
                    </StackPanel>

                    <!-- GitHub 链接 -->
                    <Border Grid.Column="1"
                            x:Name="GitHubBorder"
                            VerticalAlignment="Center"
                            Background="{ThemeResource SubtleFillColorTransparentBrush}"
                            CornerRadius="4"
                            Padding="6,4"
                            BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
                            BorderThickness="1"
                            PointerEntered="OnGitHubHoverEntered"
                            PointerExited="OnGitHubHoverExited">
                        <FlyoutBase.AttachedFlyout>
                            <Flyout x:Name="GitHubFlyout"
                                    Placement="Bottom">
                                <StackPanel Spacing="8"
                                           Width="280">
                                    <TextBlock Text="ShikenMatrix"
                                              FontSize="14"
                                              FontWeight="SemiBold"
                                              Foreground="{ThemeResource TextFillColorPrimaryBrush}"/>
                                    
                                    <TextBlock Text="https://github.com/AlienFamilyHub/ShikenMatrix"
                                              FontSize="11"
                                              FontFamily="Consolas"
                                              Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                              TextWrapping="Wrap"
                                              IsTextSelectionEnabled="True"/>
                                    
                                    <Button Content="在浏览器中打开"
                                           HorizontalAlignment="Stretch"
                                           Click="OnGitHubButtonClick"/>
                                </StackPanel>
                            </Flyout>
                        </FlyoutBase.AttachedFlyout>
                        <StackPanel Orientation="Horizontal"
                                    Spacing="4"
                                    VerticalAlignment="Center">
                            <FontIcon Glyph="&#xE774;"
                                      FontSize="10"
                                      Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                      VerticalAlignment="Center"/>
                            <TextBlock Text="GitHub"
                                       FontSize="10"
                                       FontWeight="SemiBold"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                       VerticalAlignment="Center"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </StackPanel>
        </Grid>

        <!-- MARK: 右侧面板 - 终端日志 -->
        <controls:LogPanel Grid.Column="1"
                           DataContext="{x:Bind ViewModel, Mode=OneWay}"/>
    </Grid>
</Window>