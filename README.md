# ShikenMatrix

<div align="center">

![License](https://img.shields.io/badge/license-AGPL%20v3.0-blue.svg)
![Platform](https://img.shields.io/badge/platform-macOS%20%7C%20Windows-lightgrey.svg)
![Rust](https://img.shields.io/badge/Rust-1.70%2B-orange.svg)
![Swift](https://img.shields.io/badge/Swift-5.9%2B-orange.svg)

**ä¸€ä¸ªç°ä»£åŒ–çš„è·¨å¹³å°æ¡Œé¢çª—å£ä¸åª’ä½“ä¿¡æ¯å±•ç¤ºå·¥å…·**

</div>

## ğŸ“– ç®€ä»‹

ShikenMatrix æ˜¯ä¸€ä¸ªåŸºäº **åŸç”Ÿ Rust** æ„å»ºçš„è·¨å¹³å°æ¡Œé¢åº”ç”¨ç¨‹åºï¼Œæ—¨åœ¨æä¾›ä¼˜é›…çš„çª—å£ç®¡ç†å’Œåª’ä½“ä¿¡æ¯å±•ç¤ºä½“éªŒã€‚å®ƒé‡‡ç”¨ç°ä»£åŒ–çš„åŸç”Ÿ UI æ¡†æ¶ï¼ˆ**macOS ä½¿ç”¨ SwiftUIï¼ŒWindows ä½¿ç”¨ WinUI 3**ï¼‰ï¼Œèƒ½å¤Ÿå®æ—¶æ˜¾ç¤ºå½“å‰å‰å°çª—å£çš„è¯¦ç»†ä¿¡æ¯ä»¥åŠæ­£åœ¨æ’­æ”¾çš„åª’ä½“å†…å®¹ã€‚

æœ¬é¡¹ç›®æ˜¯ [**Kizuna**](https://github.com/AlienFamilyHub/Kizuna) é¡¹ç›®çš„ç»§ä»»è€…ï¼Œåœ¨åŸæœ‰åŠŸèƒ½åŸºç¡€ä¸Šè¿›è¡Œäº†å…¨é¢çš„é‡æ„å’ŒåŠŸèƒ½å¢å¼ºï¼Œæä¾›æ›´åŠ ç°ä»£åŒ–ã€é«˜æ€§èƒ½å’Œè·¨å¹³å°çš„ç”¨æˆ·ä½“éªŒã€‚

æœ¬é¡¹ç›®é‡‡ç”¨ **GNU Affero General Public License v3.0** å¼€æºåè®®ã€‚

---

## âœ¨ ç‰¹æ€§

### ğŸ–¥ï¸ æ™ºèƒ½çª—å£ä¿¡æ¯å±•ç¤º

- **å®æ—¶ç›‘æ§**ï¼šè‡ªåŠ¨è·å–å¹¶æ˜¾ç¤ºå½“å‰æ´»åŠ¨çª—å£çš„æ ‡é¢˜ã€å›¾æ ‡å’Œè¿›ç¨‹ä¿¡æ¯
- **åº”ç”¨å›¾æ ‡å±•ç¤º**ï¼šåŠ¨æ€åŠ è½½å¹¶æ˜¾ç¤ºå‰å°åº”ç”¨çš„å›¾æ ‡ï¼ˆæ”¯æŒåŸç”Ÿç¼“å­˜ï¼‰
- **çª—å£æ ‡é¢˜è·Ÿè¸ª**ï¼šå®æ—¶æ›´æ–°çª—å£æ ‡é¢˜å˜åŒ–
- **æ™ºèƒ½ç¼“å­˜**ï¼šLRU ç¼“å­˜æœºåˆ¶ï¼Œæœ€å¤šç¼“å­˜ 20 ä¸ªåº”ç”¨å›¾æ ‡ï¼ˆ~7 MBï¼‰

### ğŸµ åª’ä½“æ’­æ”¾é›†æˆ

- **åª’ä½“å…ƒæ•°æ®**ï¼šæ”¯æŒæ˜¾ç¤ºå½“å‰æ’­æ”¾çš„éŸ³ä¹/è§†é¢‘æ ‡é¢˜ã€è‰ºæœ¯å®¶ã€ä¸“è¾‘ä¿¡æ¯
- **ä¸“è¾‘å°é¢å±•ç¤º**ï¼šè‡ªåŠ¨è·å–å¹¶æ˜¾ç¤ºé«˜è´¨é‡ä¸“è¾‘å°é¢
- **æ’­æ”¾çŠ¶æ€åŒæ­¥**ï¼šå®æ—¶åŒæ­¥æ’­æ”¾/æš‚åœçŠ¶æ€ï¼Œä»…åœ¨æ’­æ”¾æ—¶æ˜¾ç¤ºåª’ä½“ä¿¡æ¯
- **è·¨åº”ç”¨æ”¯æŒ**ï¼šæ”¯æŒç³»ç»Ÿçº§åª’ä½“æ§åˆ¶
  - **macOS**: ä½¿ç”¨ MediaRemote æ¡†æ¶ï¼ˆåŸºäº [MediaRemote-rs](https://github.com/TNXG/MediaRemote-rs)ï¼‰
  - **Windows**: ä½¿ç”¨ System Media Transport Controls (SMTC)

### ğŸ¨ ç°ä»£åŒ– UI è®¾è®¡

- **åŸç”Ÿæ¡†æ¶**ï¼šmacOS ä½¿ç”¨ SwiftUIï¼ŒWindows ä½¿ç”¨ WinUI 3ï¼Œæä¾›åŸç”Ÿä½“éªŒ
- **ç»ç’ƒæ‹Ÿæ€é£æ ¼**ï¼šé‡‡ç”¨ç²¾ç¾çš„ Acrylic/Glassmorphism è§†è§‰æ•ˆæœï¼Œå®Œç¾èå…¥ç³»ç»Ÿç¯å¢ƒ
- **è‡ªé€‚åº”ä¸»é¢˜**ï¼šè‡ªåŠ¨é€‚é…ç³»ç»Ÿäº®è‰²/æš—è‰²æ¨¡å¼ï¼Œæä¾›ä¸€è‡´çš„è§†è§‰ä½“éªŒ
- **è‡ªé€‚åº”çª—å£**ï¼šçª—å£å¤§å°æ ¹æ®å†…å®¹è‡ªåŠ¨è°ƒæ•´ï¼Œç¡®ä¿æœ€ä½³æ˜¾ç¤ºæ•ˆæœ
- **æµç•…åŠ¨ç”»**ï¼šæ‰€æœ‰äº¤äº’éƒ½é…å¤‡ç²¾å¿ƒè®¾è®¡çš„è¿‡æ¸¡åŠ¨ç”»

### ğŸ® äº¤äº’å¼çª—å£æ§åˆ¶

- **æ‹–æ‹½ç§»åŠ¨**ï¼šæŒ‰ä½é¡¶éƒ¨æ‹–æ‹½åŒºåŸŸå³å¯ç§»åŠ¨çª—å£
- **èƒ¶å›Šèœå•**ï¼šåŒå‡»æˆ–é•¿æŒ‰é¡¶éƒ¨åŒºåŸŸæ‰“å¼€äº¤äº’å¼èƒ¶å›Šèœå•
- **çª—å£æ“ä½œ**ï¼šæ”¯æŒå…³é—­ã€æœ€å°åŒ–ã€ç½®é¡¶ç­‰å¸¸ç”¨çª—å£æ“ä½œ
- **è§†è§‰åé¦ˆ**ï¼šæ‰€æœ‰äº¤äº’éƒ½æœ‰æ¸…æ™°çš„è§†è§‰å’ŒåŠ¨ç”»åé¦ˆ

### ğŸŒ è·¨å¹³å°æ”¯æŒ

- **macOS**ï¼šâœ… å®Œæ•´æ”¯æŒï¼ˆSwiftUI + Metalï¼‰
- **Windows**ï¼šğŸš§ å¼€å‘ä¸­ï¼ˆWinUI 3 + DirectXï¼‰
- **æ¶æ„è®¾è®¡**ï¼šé‡‡ç”¨å¹³å°æŠ½è±¡å±‚ï¼ˆ`platform` æ¨¡å—ï¼‰ï¼Œä¾¿äºæ‰©å±•åˆ°å…¶ä»–æ“ä½œç³»ç»Ÿ

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ··åˆæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         åŸç”Ÿ UI å±‚                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   SwiftUI   â”‚  â”‚   WinUI 3    â”‚    â”‚
â”‚  â”‚   (macOS)   â”‚  â”‚  (Windows)   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ FFI Bridge (C ABI)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Rust Backend                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Reporter (tokio async)        â”‚    â”‚
â”‚  â”‚  - WebSocket ä¸ŠæŠ¥              â”‚    â”‚
â”‚  â”‚  - æ•°æ®å»é‡ä¸ç¼“å­˜              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Platform Layer                â”‚    â”‚
â”‚  â”‚  - Window Info                 â”‚    â”‚
â”‚  â”‚  - Media Info                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ€§èƒ½ä¼˜åŒ–

| ä¼˜åŒ–é¡¹ | ç­–ç•¥ | æ•ˆæœ |
|--------|------|------|
| **å›¾æ ‡ç¼“å­˜** | LRU æ·˜æ±°ï¼Œæœ€å¤š 20 ä¸ª | å†…å­˜ä¸Šé™ ~7 MB |
| **çª—å£ç¼“å­˜** | 100ms TTLï¼ˆmacOSï¼‰ | å‡å°‘ 90% ç³»ç»Ÿè°ƒç”¨ |
| **æ‰˜ç›˜æ¨¡å¼** | ç¦ç”¨ UI æ›´æ–°ã€æ¸…ç†ç¼“å­˜ | CPU é™ä½ ~50% |
| **FFI ä¼ è¾“** | ä¸ä¼ è¾“äºŒè¿›åˆ¶æ•°æ® | é›¶æ‹·è´ |
| **åª’ä½“å»é‡** | Hash æ¯”å¯¹ + çŠ¶æ€ç¼“å­˜ | å‡å°‘ 99% é‡å¤ä¸ŠæŠ¥ |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

#### macOS

- **macOS**: 11.0 Big Sur æˆ–æ›´é«˜ç‰ˆæœ¬
- **Xcode**: 14.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- **Rust**: 1.70 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼ˆé€šè¿‡ [rustup](https://rustup.rs/) å®‰è£…ï¼‰
- **cbindgen**: ç”¨äºç”Ÿæˆ C å¤´æ–‡ä»¶

#### Windows

- **Windows 10**: ç‰ˆæœ¬ 1809 æˆ–æ›´é«˜ç‰ˆæœ¬
- **Visual Studio**: 2019 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼ˆå« C++ å·¥ä½œè´Ÿè½½ï¼‰
- **Rust**: 1.70 æˆ–æ›´é«˜ç‰ˆæœ¬
- **Windows SDK**: æœ€æ–°ç‰ˆæœ¬

### ç¼–è¯‘ä¸è¿è¡Œ

#### macOS

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/TNXG/ShikenMatrix.git
cd ShikenMatrix

# 1. æ„å»º Rust åº“
cd macos-ui
./build-rust.sh

# 2. ä½¿ç”¨ Xcode æ‰“å¼€é¡¹ç›®
open ShikenMatrix/ShikenMatrix.xcodeproj

# 3. åœ¨ Xcode ä¸­è¿è¡Œ (Cmd+R)
```

#### Windowsï¼ˆå¼€å‘ä¸­ï¼‰

```bash
# å¾… Windows ç‰ˆæœ¬å¼€å‘å®Œæˆ
```

### æƒé™é…ç½®

#### macOS

é¦–æ¬¡è¿è¡Œæ—¶ï¼Œåº”ç”¨ä¼šè¯·æ±‚**è¾…åŠ©åŠŸèƒ½æƒé™**ï¼Œè¿™æ˜¯è·å–å‰å°çª—å£ä¿¡æ¯æ‰€å¿…éœ€çš„ï¼š

1. æ‰“å¼€ **ç³»ç»Ÿè®¾ç½®** > **éšç§ä¸å®‰å…¨æ€§** > **è¾…åŠ©åŠŸèƒ½**
2. æ‰¾åˆ° `ShikenMatrix` å¹¶å‹¾é€‰å¯ç”¨
3. é‡å¯åº”ç”¨

> å¦‚é‡"æ— æ³•æ‰“å¼€ï¼Œå› ä¸ºå®ƒæ¥è‡ªèº«ä»½ä¸æ˜çš„å¼€å‘è€…"ï¼Œå¯åœ¨"ç³»ç»Ÿè®¾ç½® â†’ éšç§ä¸å®‰å…¨æ€§"ä¸­å…è®¸è¯¥ç¨‹åºè¿è¡Œï¼Œæˆ–åœ¨ç»ˆç«¯æ‰§è¡Œï¼š
>
> ```bash
> xattr -d com.apple.quarantine /Applications/ShikenMatrix.app
> ```

#### Windows

Windows ç³»ç»Ÿå¯¹çª—å£ä¿¡æ¯è®¿é—®çš„æƒé™ç®¡ç†ç›¸å¯¹å®½æ¾ï¼Œé€šå¸¸æ— éœ€é¢å¤–é…ç½®å³å¯æ­£å¸¸ä½¿ç”¨ã€‚

---

## ğŸ’¡ ä½¿ç”¨è¯´æ˜

### åŸºæœ¬æ“ä½œ

- **ç§»åŠ¨çª—å£**ï¼šæŒ‰ä½é¡¶éƒ¨æ‹–æ‹½åŒºåŸŸï¼ˆæ˜¾ç¤ºä¸ºä¸‰ç‚¹æ¨ªçº¿æŒ‡ç¤ºå™¨ï¼‰å¹¶æ‹–åŠ¨
- **æ‰“å¼€èœå•**ï¼šåŒå‡»æˆ–é•¿æŒ‰é¡¶éƒ¨æ‹–æ‹½åŒºåŸŸï¼Œä¼šå¼¹å‡ºèƒ¶å›Šèœå•
- **å…³é—­çª—å£**ï¼šç‚¹å‡»èƒ¶å›Šèœå•ä¸­çš„çº¢è‰²å…³é—­æŒ‰é’®
- **æœ€å°åŒ–**ï¼šç‚¹å‡»èƒ¶å›Šèœå•ä¸­çš„é»„è‰²æœ€å°åŒ–æŒ‰é’®
- **çª—å£ç½®é¡¶**ï¼šç‚¹å‡»èƒ¶å›Šèœå•ä¸­çš„è“è‰²ç½®é¡¶æŒ‰é’®ï¼ˆå†æ¬¡ç‚¹å‡»å–æ¶ˆç½®é¡¶ï¼‰

### ç•Œé¢è¯´æ˜

åº”ç”¨ç•Œé¢åˆ†ä¸ºä¸¤ä¸ªä¸»è¦éƒ¨åˆ†ï¼š

1. **å‰å°çª—å£ä¿¡æ¯å¡ç‰‡**ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰
   - æ˜¾ç¤ºå½“å‰æ´»åŠ¨çª—å£çš„åº”ç”¨å›¾æ ‡
   - æ˜¾ç¤ºåº”ç”¨åç§°å’Œçª—å£æ ‡é¢˜

2. **åª’ä½“æ’­æ”¾ä¿¡æ¯å¡ç‰‡**ï¼ˆä»…åœ¨æ’­æ”¾æ—¶æ˜¾ç¤ºï¼‰
   - æ˜¾ç¤ºä¸“è¾‘å°é¢
   - æ˜¾ç¤ºæ­Œæ›²åç§°ã€è‰ºæœ¯å®¶å’Œä¸“è¾‘ä¿¡æ¯
   - è‡ªåŠ¨éšè—ï¼ˆå½“åª’ä½“æš‚åœæˆ–æ— æ’­æ”¾å†…å®¹æ—¶ï¼‰

---

## ğŸ“‚ é¡¹ç›®ç»“æ„

```
ShikenMatrix/
â”œâ”€â”€ src/                          # Rust åç«¯ä»£ç 
â”‚   â”œâ”€â”€ ffi/                      # FFI æ¥å£ï¼ˆC ABIï¼‰
â”‚   â”‚   â””â”€â”€ reporter.rs           # ä¸ŠæŠ¥æœåŠ¡ FFI
â”‚   â”œâ”€â”€ platform/                 # å¹³å°æŠ½è±¡å±‚
â”‚   â”‚   â”œâ”€â”€ mod.rs                # å¹³å°æ¥å£å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ macos/                # macOS å¹³å°å®ç°
â”‚   â”‚   â”‚   â”œâ”€â”€ window.rs         # çª—å£ç›‘æ§ (Accessibility API)
â”‚   â”‚   â”‚   â””â”€â”€ media.rs          # åª’ä½“ç›‘æ§ (MediaRemote)
â”‚   â”‚   â””â”€â”€ windows/              # Windows å¹³å°å®ç°ï¼ˆå¼€å‘ä¸­ï¼‰
â”‚   â”‚       â”œâ”€â”€ window.rs         # çª—å£ç›‘æ§ (WinAPI)
â”‚   â”‚       â””â”€â”€ media.rs          # åª’ä½“ç›‘æ§ (SMTC)
â”‚   â”œâ”€â”€ services/                 # æ ¸å¿ƒæœåŠ¡
â”‚   â”‚   â””â”€â”€ reporter.rs           # ä¸ŠæŠ¥æœåŠ¡ï¼ˆWebSocketï¼‰
â”‚   â”œâ”€â”€ lib.rs                    # åº“å…¥å£
â”‚   â””â”€â”€ main.rs                   # å¯æ‰§è¡Œæ–‡ä»¶å…¥å£
â”‚
â”œâ”€â”€ macos-ui/                     # macOS UI é¡¹ç›®
â”‚   â”œâ”€â”€ ShikenMatrix/             # Xcode é¡¹ç›®
â”‚   â”‚   â”œâ”€â”€ ShikenMatrix/         # SwiftUI æºç 
â”‚   â”‚   â”‚   â”œâ”€â”€ ShikenMatrixApp.swift    # åº”ç”¨å…¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ ContentView.swift        # ä¸»çª—å£
â”‚   â”‚   â”‚   â”œâ”€â”€ RustBridge.swift         # FFI æ¡¥æ¥
â”‚   â”‚   â”‚   â””â”€â”€ Assets.xcassets/         # èµ„æºæ–‡ä»¶
â”‚   â”‚   â””â”€â”€ ShikenMatrix.xcodeproj       # Xcode é¡¹ç›®æ–‡ä»¶
â”‚   â”œâ”€â”€ build-rust.sh             # Rust æ„å»ºè„šæœ¬
â”‚   â””â”€â”€ rust-lib/                 # ç¼–è¯‘åçš„ Rust åº“
â”‚
â”œâ”€â”€ Cargo.toml                    # Rust ä¾èµ–é…ç½®
â”œâ”€â”€ cbindgen.toml                 # cbindgen é…ç½®
â””â”€â”€ README.md                     # é¡¹ç›®è¯´æ˜æ–‡æ¡£
```

---

## ğŸ”§ å¼€å‘æŒ‡å—

### æŠ€æœ¯æ¶æ„æ¦‚è¿°

**åç«¯ï¼ˆRustï¼‰**

- å¹³å°æŠ½è±¡å±‚è®¾è®¡ï¼Œç»Ÿä¸€çš„æ¥å£å®šä¹‰
- ä½¿ç”¨ FFI (C ABI) æš´éœ²ç³»ç»Ÿçº§åŠŸèƒ½
- å¼‚æ­¥ä»»åŠ¡å¤„ç†ï¼ˆåŸºäº tokioï¼‰
- å¹³å°ç‰¹å®šå®ç°ï¼š
  - **macOS**: ä½¿ç”¨ objc2 ç»‘å®šè°ƒç”¨ Core Foundation / AppKit / MediaRemote
  - **Windows**: ä½¿ç”¨ winapi è°ƒç”¨ WinAPI / Windows Media Control

**å‰ç«¯**

- **macOS**: SwiftUI + AppKit
  - ä½¿ç”¨ `@main` å’Œ `App` åè®®
  - åŸç”Ÿçª—å£æ§åˆ¶å’Œç³»ç»Ÿé›†æˆ
  - Metal åŠ é€Ÿçš„å›¾å½¢æ¸²æŸ“
- **Windows**: WinUI 3 + Windows App SDK
  - ä½¿ç”¨ WinUI 3 çš„ç°ä»£æ§ä»¶
  - Fluent Design è®¾è®¡è¯­è¨€

### æ·»åŠ æ–°åŠŸèƒ½

1. **åç«¯åŠŸèƒ½**ï¼šåœ¨ `src/platform/` ä¸­æ·»åŠ å¹³å°æ¥å£å’Œå®ç°
2. **å‰ç«¯ç»„ä»¶**ï¼šåœ¨å¯¹åº”å¹³å°çš„ UI é¡¹ç›®ä¸­åˆ›å»ºæ–°çš„ç»„ä»¶
3. **FFI æ¡¥æ¥**ï¼šåœ¨ `src/ffi/` ä¸­æ·»åŠ  C æ¥å£ï¼Œå‰ç«¯é€šè¿‡ `RustBridge` è°ƒç”¨

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

**åç«¯æŠ€æœ¯**

- **Rust** - ç³»ç»Ÿçº§ç¼–ç¨‹è¯­è¨€
- **tokio** - å¼‚æ­¥è¿è¡Œæ—¶
- **serde** - åºåˆ—åŒ–/ååºåˆ—åŒ–
- **tokio-tungstenite** - WebSocket å®¢æˆ·ç«¯

**å¹³å°é›†æˆ**

- **macOS**:
  - objc2 - Objective-C è¿è¡Œæ—¶ç»‘å®š
  - core-foundation - Core Foundation æ¡†æ¶ç»‘å®š
  - [MediaRemote-rs](https://github.com/TNXG/MediaRemote-rs) - MediaRemote æ¡†æ¶ç»‘å®šï¼ˆè‡ªæœ‰åº“ï¼‰
- **Windows**:
  - winapi - Windows API ç»‘å®š
  - windows-rs - ç°ä»£ Windows API ç»‘å®š

**å‰ç«¯æŠ€æœ¯**

- **macOS**: SwiftUI, AppKit, Metal
- **Windows**: WinUI 3, Windows App SDK, DirectX

---

## â“ å¸¸è§é—®é¢˜

### ğŸ’» macOS ç›¸å…³

#### Q: ä¸ºä»€ä¹ˆ macOS ä¸Šæ— æ³•è·å–çª—å£ä¿¡æ¯ï¼Ÿ

**A**: è¯·ç¡®ä¿å·²æˆäºˆåº”ç”¨è¾…åŠ©åŠŸèƒ½æƒé™ã€‚å‰å¾€ **ç³»ç»Ÿè®¾ç½®** > **éšç§ä¸å®‰å…¨æ€§** > **è¾…åŠ©åŠŸèƒ½**ï¼Œå‹¾é€‰ `ShikenMatrix`ã€‚

### ğŸ’» Windows ç›¸å…³

#### Q: ä¸ºä»€ä¹ˆç½‘æ˜“äº‘éŸ³ä¹çš„åª’ä½“ä¿¡æ¯ä¸æ˜¾ç¤ºï¼Ÿ

**A**: ç½‘æ˜“äº‘éŸ³ä¹ï¼ˆç­‰å›½å†…éŸ³ä¹æ’­æ”¾å™¨ï¼‰ä¸æŒ‰ç…§å¾®è½¯å®˜æ–¹çš„åª’ä½“æ¸ é“ä¸ŠæŠ¥åª’ä½“ä¿¡æ¯ï¼ˆå³ Windows System Media Control é›†æˆï¼‰ã€‚ä» Windows 10 ç‰ˆæœ¬ 1607 å¼€å§‹ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨ `MediaPlayer` ç±»æˆ– `AudioGraph` ç±»æ’­æ”¾åª’ä½“çš„ UWP åº”ç”¨ä¼šè‡ªåŠ¨ä¸ SMTC é›†æˆã€‚åªéœ€å®ä¾‹åŒ– `MediaPlayer` çš„æ–°å®ä¾‹ï¼Œå¹¶å°† `MediaSource`ã€`MediaPlaybackItem` æˆ– `MediaPlaybackList` åˆ†é…ç»™æ’­æ”¾å™¨çš„ `Source` å±æ€§ï¼Œç„¶åç”¨æˆ·å°†åœ¨ SMTC ä¸­çœ‹åˆ°ä½ çš„åº”ç”¨åç§°ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨ SMTC æ§ä»¶æ’­æ”¾ã€æš‚åœå’Œåœ¨æ’­æ”¾åˆ—è¡¨ä¸­ç§»åŠ¨ã€‚ â€”â€” Windows æ–‡æ¡£

è¿™æ—¶éœ€è¦å…¶ä»–æ–¹æ³•æ¥ä½¿æœ¬ç¨‹åºçš„åª’ä½“ä¸ŠæŠ¥ç»“æ„ç”Ÿæ•ˆï¼Œå¯ä»¥é€šè¿‡æ’ä»¶ä½¿å…¶é€šè¿‡ SMTC ä¸ŠæŠ¥ä¿¡æ¯ã€‚å¯¹äºç½‘æ˜“äº‘éŸ³ä¹ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨ `MicroCBer/BetterNCM` å’Œ `BetterNCM/InfinityLink` æ­é…ä½¿ç”¨ã€‚

> **TL;DR**:
>
> å›½å†…éŸ³ä¹æ’­æ”¾å™¨ï¼ˆå¦‚ç½‘æ˜“äº‘éŸ³ä¹ï¼‰æœªé‡‡ç”¨ Windows æ ‡å‡†åª’ä½“æ§åˆ¶æ¥å£ (SMTC)ï¼Œå¯¼è‡´æ— æ³•æ˜¾ç¤ºåª’ä½“ä¿¡æ¯ã€‚å¯é€šè¿‡å®‰è£…ç‰¹å®šæ’ä»¶ï¼ˆå¦‚ç½‘æ˜“äº‘éŸ³ä¹çš„ `BetterNCM` + `InfinityLink`ï¼‰æ¥è§£å†³ã€‚

### â“ é€šç”¨é—®é¢˜

#### Q: åª’ä½“ä¿¡æ¯ä¸æ˜¾ç¤ºæ€ä¹ˆåŠï¼Ÿ

**A**: åª’ä½“ä¿¡æ¯ä»…åœ¨æœ‰éŸ³ä¹/è§†é¢‘æ­£åœ¨æ’­æ”¾æ—¶æ˜¾ç¤ºã€‚è¯·ç¡®ä¿ï¼š

- ç³»ç»Ÿä¸­æœ‰åª’ä½“æ­£åœ¨æ’­æ”¾
- æ’­æ”¾å™¨æ”¯æŒç³»ç»Ÿçº§åª’ä½“æ§åˆ¶ï¼ˆå¦‚ Apple Musicã€Spotifyã€Chrome ç­‰ï¼‰

#### Q: çª—å£å¤§å°å¯ä»¥è°ƒæ•´å—ï¼Ÿ

**A**: çª—å£å¤§å°ä¼šæ ¹æ®å†…å®¹è‡ªåŠ¨è°ƒæ•´ï¼Œä»¥ç¡®ä¿æœ€ä½³æ˜¾ç¤ºæ•ˆæœã€‚å½“å‰ç‰ˆæœ¬ä¸æ”¯æŒæ‰‹åŠ¨è°ƒæ•´å¤§å°ã€‚

#### Q: æ”¯æŒå“ªäº›æ“ä½œç³»ç»Ÿï¼Ÿ

**A**: ç›®å‰å®Œæ•´æ”¯æŒ macOSï¼ŒWindows æ”¯æŒæ­£åœ¨å¼€å‘ä¸­ã€‚

#### Q: å¦‚ä½•è´¡çŒ®ä»£ç ï¼Ÿ

**A**: æ¬¢è¿æäº¤ Pull Requestï¼è¯·ç¡®ä¿ï¼š

- éµå¾ªé¡¹ç›®çš„ä»£ç é£æ ¼
- ä¸ºæ–°åŠŸèƒ½æ·»åŠ é€‚å½“çš„æ³¨é‡Š
- æµ‹è¯•åœ¨ä¸åŒå¹³å°ä¸Šçš„å…¼å®¹æ€§

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäº [GNU Affero General Public License v3.0](LICENSE) å¼€æºã€‚

---

## ğŸ‘¨â€ğŸ’» å¼€å‘è€…

Developed by **TNXG**
- GitHub: [TNXG](https://github.com/TNXG)
- Email: tianxiang_tnxg@outlook.com

---

## ğŸ” æŠ€æœ¯å®ç°ç»†èŠ‚

### MediaRemote-rsï¼šç»•è¿‡ macOS 15.4+ æƒé™éªŒè¯

æœ¬é¡¹ç›®ä½¿ç”¨çš„ [MediaRemote-rs](https://github.com/TNXG/MediaRemote-rs) å‚è€ƒäº† [mediaremote-adapter](https://github.com/ungive/mediaremote-adapter) çš„è®¾è®¡æ€è·¯ï¼Œé€šè¿‡å·§å¦™çš„ä¸‰å±‚æ¶æ„ç»•è¿‡äº† macOS 15.4+ å¼•å…¥çš„ MediaRemote entitlement éªŒè¯ã€‚

#### æ ¸å¿ƒåŸç†

**ä¸ºä»€ä¹ˆèƒ½å·¥ä½œï¼Ÿ**

æ ¹æ® [@My-Iris](https://github.com/Mx-Iris) çš„å‘ç°ï¼Œbundle identifier ä»¥ `com.apple.` å¼€å¤´çš„è¿›ç¨‹è¢«æˆäºˆè®¿é—® MediaRemote æ¡†æ¶çš„æƒé™ã€‚ç³»ç»Ÿ Perl äºŒè¿›åˆ¶æ–‡ä»¶ `/usr/bin/perl` çš„ bundle identifier ä¸º `com.apple.perl`ï¼Œå› æ­¤è¢«ç³»ç»Ÿä¿¡ä»»ã€‚

#### æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Rust åº”ç”¨ (ShikenMatrix)        â”‚
â”‚  (è°ƒç”¨ mediaremote-rs crate)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ FFI / dylib åµŒå…¥
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  libmediaremote_rs.dylib (é¢„ç¼–è¯‘)  â”‚
â”‚  (åŒ…å« MediaRemote ç»‘å®šä»£ç )        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ Perl è„šæœ¬è°ƒç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Perl Loader (æ²™ç›’å±‚)               â”‚
â”‚  (ç»•è¿‡æƒé™éªŒè¯)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ MediaRemote Framework
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  macOS MediaRemote.framework       â”‚
â”‚  (Apple ç§æœ‰æ¡†æ¶)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ ¸å¿ƒæŠ€æœ¯

1. **åµŒå…¥é¢„ç¼–è¯‘ dylib**
   - å°†é¢„ç¼–è¯‘çš„ dylib åµŒå…¥åˆ° Rust äºŒè¿›åˆ¶ä¸­
   - è¿è¡Œæ—¶æå–åˆ°ä¸´æ—¶ç›®å½•ï¼Œé¿å…ç­¾åä¾èµ–

2. **Perl æ²™ç›’å±‚**
   - ä½¿ç”¨ Perl çš„ `DynaLoader` åŠ¨æ€åŠ è½½ dylib
   - ç»•è¿‡ macOS 15.4+ çš„ entitlement éªŒè¯ï¼ˆPerl è¿›ç¨‹ä¸å—é™åˆ¶ï¼‰

3. **objc2 ç›´æ¥ç»‘å®š**
   - é€šè¿‡ `objc2` ç›´æ¥è°ƒç”¨ MediaRemote Framework
   - ä½¿ç”¨ `MRMediaRemoteGetNowPlayingInfo` è·å–æ’­æ”¾ä¿¡æ¯
   - è§£æ NSDictionary è·å–å…ƒæ•°æ®å’Œå°é¢

4. **æ™ºèƒ½ Artwork å¤„ç†**
   - ä» MediaRemote è·å–äºŒè¿›åˆ¶å°é¢æ•°æ®
   - Base64 ç¼–ç ä¼ è¾“
   - è‡ªåŠ¨æ£€æµ‹ MIME ç±»å‹ï¼ˆJPEG/PNG/GIF/WebPï¼‰

#### ä¼˜åŠ¿å¯¹æ¯”

| æ–¹æ¡ˆ | macOS 15.4+ æ”¯æŒ | éœ€è¦ Entitlement | ç»´æŠ¤æˆæœ¬ |
|------|------------------|-----------------|----------|
| **MediaRemote-rs** | âœ… å®Œç¾æ”¯æŒ | âŒ ä¸éœ€è¦ | ä¸­ç­‰ï¼ˆè‡ªæœ‰åº“ï¼‰ |
| mediaremote-adapter | âœ… å®Œç¾æ”¯æŒ | âŒ ä¸éœ€è¦ | ä¸­ç­‰ï¼ˆè„šæœ¬ï¼‰ |
| ç›´æ¥ MediaRemote | âŒ å—é™åˆ¶ | âœ… éœ€è¦ | é«˜ |
| ç³»ç»Ÿ MP* æ¡†æ¶ | âš ï¸ ä»… Apple Music | âŒ ä¸éœ€è¦ | ä½ï¼ˆå®˜æ–¹ï¼‰ |

è¿™ç§æ¶æ„ä½¿å¾— ShikenMatrix èƒ½å¤Ÿåœ¨æœ€æ–°çš„ macOS ç³»ç»Ÿä¸Šæ— éšœç¢åœ°è·å–åª’ä½“ä¿¡æ¯ï¼Œæ— éœ€ç”³è¯·ç‰¹æ®Šæƒé™æˆ–è¿›è¡Œå¤æ‚çš„ä»£ç ç­¾åé…ç½®ã€‚

---

## ğŸ™ è‡´è°¢

- [objc2](https://github.com/madsmtm/objc2) - Objective-C ç»‘å®š
- [tokio](https://tokio.rs/) - å¼‚æ­¥è¿è¡Œæ—¶
- [SwiftUI](https://developer.apple.com/xcode/swiftui/) - åŸç”Ÿ UI æ¡†æ¶
- [mediaremote-adapter](https://github.com/ungive/mediaremote-adapter) - Perl æ²™ç›’å±‚è®¾è®¡æ€è·¯å‚è€ƒ
- [MediaRemote-rs](https://github.com/TNXG/MediaRemote-rs) - macOS MediaRemote æ¡†æ¶ç»‘å®šï¼ˆè‡ªæœ‰åº“ï¼‰
- [WinUI 3](https://developer.microsoft.com/windows/apps/winui/) - Windows åŸç”Ÿ UI æ¡†æ¶
